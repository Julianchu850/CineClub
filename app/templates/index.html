<!DOCTYPE html>
<html>

<head>
    <title>Family Film Club</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <div class="container py-4">

        <h1>üé¨ CINECLUB</h1>

        {% if weekly_movie %}
        <div class="card mb-5 shadow-sm movie-week-card">
            <div class="card-body">


                <div class="row align-items-center g-4">

                    <div class="col-auto">
                        {% if weekly_details and weekly_details.poster_path %}
                        <div class="poster-wrapper poster-lg">
                            <img src="https://image.tmdb.org/t/p/w500{{ weekly_details.poster_path }}" alt="Poster">
                        </div>
                        {% endif %}
                    </div>

                    <div class="col-md">
                        <div class="movie-meta">
                            <h1 class="mb-1">
                                {{ weekly_movie.title }}
                                {% if weekly_details.release_date %}
                                ({{ weekly_details.release_date[:4] }})
                                {% endif %}
                            </h1>

                            {% if weekly_details.tagline %}
                            <p><em>{{ weekly_details.tagline }}</em></p>
                            {% endif %}

                            <p>
                                {% if weekly_details.runtime %}
                                {{ weekly_details.runtime }} mins ‚Ä¢
                                {% endif %}
                                {% for g in weekly_details.genres %}
                                {{ g.name }}{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </p>

                            {% if director %}
                            <p class="mb-2"><strong>Director:</strong> {{ director }}</p>
                            {% endif %}

                            {% if weekly_details.overview %}
                            <p class="mb-3">{{ weekly_details.overview }}</p>
                            {% endif %}

                            <a class="btn btn-premium" href="/movie/{{ weekly_movie.id }}">
                                ‚≠ê Calificar y ver detalles
                            </a>
                        </div>
                    </div>

                </div>


            </div>
        </div>
        {% endif %}

        <div class="mt-4 history-section">

            <h2 class="mb-3">Pel√≠culas Vistas</h2>

            <div class="d-flex justify-content-between align-items-center gap-3 mb-3 filters-row">

                <form method="get" action="/" class="d-flex gap-2 align-items-center m-0 filters-form">

                    <input class="form-control admin-input" style="max-width:320px;" type="text" name="q"
                        value="{{ q or '' }}" placeholder="Busca una Pel√≠cula...">

                    <select class="form-select admin-input" name="sort" style="max-width:220px;">
                        <option value="rating" {% if sort=='rating' %}selected{% endif %}>Organiza por Calificaci√≥n
                        </option>
                        <option value="date" {% if sort=='date' %}selected{% endif %}>Organiza por Fecha Vista</option>
                    </select>

                    <button class="btn btn-premium btn-sm" type="submit">Aplicar</button>

                    <a class="btn btn-outline-light btn-sm btn-reset" href="/">Reiniciar</a>

                </form>

                <a class="btn btn-premium btn-sm btn-diary" href="/diary">Abrir Calendario</a>

            </div>

        </div>

        <div class="row g-4">
            {% for item in movie_data %}
            <div class="col-6 col-md-3">
                <div class="card h-100 shadow-sm movie-card">
                    <a class="poster-link" href="/movie/{{ item.movie.id }}">
                        <div class="poster-wrapper poster-grid mt-3 mx-auto">
                            {% if item.details and item.details.poster_path %}
                            <img src="https://image.tmdb.org/t/p/w500{{ item.details.poster_path }}" alt="poster">
                            {% endif %}
                        </div>
                    </a>

                    <div class="card-body text-center">
                        <a class="movie-title d-block mb-1" href="/movie/{{ item.movie.id }}">{{ item.movie.title }}</a>

                        {% if item.average %}
                        <div class="movie-rating">‚≠ê {{ item.average }}</div>
                        {% else %}
                        <div>Sin Calificaci√≥n</div>
                        {% endif %}

                        {% if item.movie.date_watched %}
                        <div class="text-muted" style="font-size:.85rem;">{{ item.movie.date_watched }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>





    </div>

</body>

</html>

<style>
    body {
        background-color: #14181c;
        color: #f1f1f1;
    }

    .card {
        background-color: #1c2228;
        color: #f1f1f1;
    }

    a {
        color: #90caf9;
    }

    .poster-wrapper {
        aspect-ratio: 2 / 3;
        overflow: hidden;
        border-radius: 10px;
        background-color: #1c2228;
        flex-shrink: 0;
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.45);
    }

    .poster-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Movie of the Week poster size */
    .poster-lg {
        width: 260px;
    }

    /* Grid poster size */
    .poster-grid {
        width: 100%;
        max-width: 220px;
    }

    /* Responsive tweaks */
    @media (max-width: 768px) {
        .poster-lg {
            width: 190px;
        }

        .poster-grid {
            max-width: 160px;
        }
    }

    .movie-meta {
        margin-top: 6px;
    }

    .movie-title {
        color: #e6edf3;
        font-weight: 600;
        text-decoration: none;
    }

    .movie-rating {
        color: #ffd166;
        font-size: 0.95rem;
    }

    .poster-link {
        text-decoration: none;
    }

    .poster-link .poster-wrapper {
        transition: transform .15s ease, box-shadow .15s ease;
    }

    .poster-link:hover .poster-wrapper {
        transform: translateY(-2px);
        box-shadow: 0 14px 28px rgba(0, 0, 0, .55);
    }

    .movie-card .card-body {
        padding-top: 0.5rem;
        /* so the mt-3 feels intentional */
        padding-bottom: 1rem;
    }

    .movie-week-card {
        border: 0;
        /* removes blue accent */
        background: linear-gradient(180deg, #1c2228 0%, #151a1f 100%);
    }

    .btn-premium {
        background: linear-gradient(135deg, #ffd166, #f4b942);
        color: #1b1f24;
        border: 0;
        border-radius: 999px;
        /* pill shape */
        padding: 0.5rem 1.1rem;
        font-weight: 600;
        letter-spacing: .2px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, .35);
        transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
    }

    .btn-premium:hover {
        transform: translateY(-1px);
        box-shadow: 0 12px 26px rgba(0, 0, 0, .45);
        filter: brightness(1.05);
        color: #111;
        /* keep readable */
    }

    .movie-week-card h3 {
        letter-spacing: .4px;
        font-weight: 700;
    }

    .movie-week-card .text-muted {
        opacity: .85;
    }

    .admin-input {
        background: #11161b !important;
        border: 1px solid rgba(255, 255, 255, .08) !important;
        color: #f1f1f1 !important;
        border-radius: 12px;
    }

    .admin-input::placeholder {
        color: rgba(241, 241, 241, .55);
    }

    .admin-input:focus {
        background: #11161b !important;
        color: #f1f1f1 !important;
        border-color: rgba(255, 209, 102, .55) !important;
        box-shadow: 0 0 0 .25rem rgba(255, 209, 102, .08) !important;
    }

    .btn-reset {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 84px;
        /* makes it look balanced */
        border-radius: 999px;
    }

    .btn-diary {
        border-radius: 999px;
        padding: .5rem 1.15rem;
        white-space: nowrap;
    }

    .history-section {
        margin-top: 2rem;
    }

    /* Keep filters + diary button on one line (desktop) */
    .filters-row {
        flex-wrap: nowrap;
    }

    /* Keep inputs from growing too much */
    .filters-form input,
    .filters-form select {
        max-width: 260px;
    }

    /* Allow wrapping ONLY on small screens */
    @media (max-width: 768px) {
        .filters-row {
            flex-wrap: wrap;
            gap: 10px;
        }

        .filters-form {
            flex-wrap: wrap;
        }

        .filters-form input,
        .filters-form select {
            max-width: 100%;
        }
    }
</style>