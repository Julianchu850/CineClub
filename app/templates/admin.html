<!DOCTYPE html>
<html>

<head>
    <title>Admin - Cineclub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container-lg py-4">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="mb-0">üé¨ Panel de Administrador</h1>
                <p>Registra Pel√≠culas y miembros de la familia</p>
            </div>
            <a href="/" class="btn btn-outline-light">Regresar</a>
        </div>

        <div class="row g-4">

            <!-- TMDB Search -->
            <div class="col-lg-7">
                <div class="card shadow-sm admin-card">
                    <div class="card-body">
                        <h4 class="mb-3">üîé Agregar Pel√≠cula (TMDB)</h4>

                        <form action="/admin/search" method="get" class="d-flex gap-2">
                            <input class="form-control admin-input" type="text" name="query"
                                placeholder="Busca Pel√≠cula en TMDB (titulo)" required>
                            <button class="btn btn-premium" type="submit">Buscar</button>
                        </form>

                        <small class="text-muted d-block mt-2">
                            Tip: Seleccionaras la ‚Äúfecha vista‚Äù despues de elegir la pel√≠cula.
                        </small>
                    </div>
                </div>
            </div>

            <!-- Add Family Member -->
            <div class="col-lg-5">
                <div class="card shadow-sm admin-card">
                    <div class="card-body">
                        <h4 class="mb-3">üë• Miembros</h4>

                        <form action="/admin/add_member" method="post" class="d-flex gap-2 mb-3">
                            <input class="form-control admin-input" type="text" name="member_name"
                                placeholder="Agrega Persona (Nombre)" required>
                            <button class="btn btn-outline-premium" type="submit">Agregar</button>
                        </form>

                        {% if members %}
                        <div class="d-flex flex-wrap gap-2">
                            {% for m in members %}
                            <span class="badge member-badge">{{ m.name }}</span>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-muted mb-0">No hay miembros a√∫n.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <form method="get" action="/admin" class="d-flex gap-2 flex-wrap mb-3">
                <input class="form-control admin-input" style="max-width:320px;" type="text" name="q"
                    value="{{ q or '' }}" placeholder="Busca una Pel√≠cula...">

                <select class="form-select admin-input" name="status" style="max-width:220px;">
                    <option value="all" {% if status=='all' %}selected{% endif %}>Todos los estados</option>
                    <option value="weekly" {% if status=='weekly' %}selected{% endif %}>Pel√≠cula de la Semana</option>
                    <option value="seen" {% if status=='seen' %}selected{% endif %}>Vista</option>
                </select>

                <select class="form-select admin-input" name="sort" style="max-width:220px;">
                    <option value="date_desc" {% if sort=='date_desc' %}selected{% endif %}>Fecha (m√°s reciente)
                    </option>
                    <option value="date_asc" {% if sort=='date_asc' %}selected{% endif %}>Fecha (m√°s antigua)</option>
                    <option value="title" {% if sort=='title' %}selected{% endif %}>T√≠tulo (A‚ÄìZ)</option>
                </select>

                <button class="btn btn-outline-premium" type="submit">Aplicar</button>
                <a class="btn btn-outline-light" href="/admin">Reiniciar</a>
            </form>

            <div class="card shadow-sm admin-card mt-4">
                <div class="card-body">
                    <h4 class="mb-3">üéûÔ∏è Administrar Pel√≠culas</h4>

                    {% if movies %}
                    <div class="list-group list-group-flush">

                        {% for m in movies %}
                        <div class="list-group-item bg-transparent border-dark text-light py-3">

                            <div class="d-flex justify-content-between align-items-center gap-3 flex-wrap">


                                <!-- Left: Title -->
                                <div style="min-width: 240px;">
                                    <div class="fw-bold">{{ m.title }}</div>

                                </div>

                                <!-- Middle: Edit form -->
                                <form action="/admin/update_movie/{{ m.id }}" method="post"
                                    class="d-flex gap-2 align-items-end flex-wrap">

                                    <div>
                                        <label class="form-label mb-1 text-muted">Fecha vista</label>
                                        <input class="form-control admin-input" type="date" name="date_watched"
                                            value="{{ m.date_watched or '' }}" required>
                                    </div>

                                    <div>
                                        <label class="form-label mb-1 text-muted">Status</label>
                                        <select class="form-select admin-input" name="status">
                                            <option value="weekly" {% if m.status=="weekly" %}selected{% endif %}>
                                                Pel√≠cula de la Semana
                                            </option>
                                            <option value="seen" {% if m.status=="seen" %}selected{% endif %}>
                                                Vista
                                            </option>
                                        </select>
                                    </div>

                                    <button class="btn btn-outline-premium" type="submit">Guardar</button>
                                </form>

                                <!-- Right: Delete -->
                                <form action="/admin/delete_movie/{{ m.id }}" method="post"
                                    onsubmit="return confirm('Delete this movie and all its ratings?');">
                                    <button class="btn btn-sm btn-outline-danger">Eliminar</button>
                                </form>

                            </div>

                        </div>
                        {% endfor %}

                    </div>
                    {% else %}
                    <p class="text-muted mb-0">No hay pel√≠culas a√∫n.</p>
                    {% endif %}
                </div>
            </div>



        </div>

    </div>
</body>

</html>

<style>
    body {
        background-color: #14181c;
        color: #f1f1f1;
    }

    .text-muted {
        color: rgba(241, 241, 241, .65) !important;
    }

    .admin-card {
        background: linear-gradient(180deg, #1c2228 0%, #151a1f 100%);
        border: 0;
        color: #f1f1f1;
        border-radius: 14px;
    }

    .admin-input {
        background: #11161b;
        border: 1px solid rgba(255, 255, 255, .08);
        color: #f1f1f1;
    }

    .admin-input:focus {
        background: #11161b;
        color: #f1f1f1;
        border-color: rgba(255, 209, 102, .55);
        box-shadow: 0 0 0 .25rem rgba(255, 209, 102, .08);
    }

    .btn-premium {
        background: linear-gradient(135deg, #ffd166, #f4b942);
        color: #1b1f24;
        border: 0;
        border-radius: 999px;
        padding: .5rem 1.1rem;
        font-weight: 650;
        box-shadow: 0 8px 20px rgba(0, 0, 0, .35);
        transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
    }

    .btn-premium:hover {
        transform: translateY(-1px);
        box-shadow: 0 12px 26px rgba(0, 0, 0, .45);
        filter: brightness(1.05);
        color: #111;
    }

    .btn-outline-premium {
        border: 1px solid rgba(255, 209, 102, .55);
        color: #ffd166;
        border-radius: 999px;
        padding: .5rem 1rem;
        font-weight: 600;
        background: transparent;
    }

    .btn-outline-premium:hover {
        background: rgba(255, 209, 102, .12);
        color: #ffd166;
    }

    .member-badge {
        background: rgba(255, 255, 255, .08);
        border: 1px solid rgba(255, 255, 255, .10);
        border-radius: 999px;
        padding: .55rem .75rem;
        font-weight: 600;
    }
</style>